# Changelog

## [Phase 4] - 2025-01-XX

### –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –§–∞–∑–∞ 4: –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π —Å–ª–æ–π

#### üéØ –¶–µ–ª—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π —Å–ª–æ–π –ø–æ–≤–µ—Ä—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –µ–¥–∏–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º –≤ SOL
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (—ç–∫—Å–ø–æ–∑–∏—Ü–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π)
- –£—á–µ—Ç–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ equity curve –∏ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### üìÅ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö

##### 1. **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `backtester/domain/portfolio.py`**

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- `FeeModel` - –º–æ–¥–µ–ª—å –∫–æ–º–∏—Å—Å–∏–π –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
  - `swap_fee_pct` - –∫–æ–º–∏—Å—Å–∏—è swap (0.3% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `lp_fee_pct` - –∫–æ–º–∏—Å—Å–∏—è LP (0.1% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `slippage_pct` - –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (10% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `network_fee_sol` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏ (0.0005 SOL)
  - –ú–µ—Ç–æ–¥ `effective_fee_pct()` - —Ä–∞—Å—á–µ—Ç —Å—É–º–º–∞—Ä–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π round-trip

- `PortfolioConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - `initial_balance_sol` - –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (10.0 SOL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `allocation_mode` - —Ä–µ–∂–∏–º –∞–ª–ª–æ–∫–∞—Ü–∏–∏ ("fixed" –∏–ª–∏ "dynamic")
  - `percent_per_trade` - –¥–æ–ª—è –∫–∞–ø–∏—Ç–∞–ª–∞ –Ω–∞ —Å–¥–µ–ª–∫—É (10% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `max_exposure` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è (50% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `max_open_positions` - –º–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (10 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - `backtest_start/end` - –æ–∫–Ω–æ –±—ç–∫—Ç–µ—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `runner_reset_enabled` - —Ñ–ª–∞–≥ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ Runner-XN

- `PortfolioStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - `final_balance_sol` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
  - `total_return_pct` - –æ–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
  - `max_drawdown_pct` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
  - `trades_executed` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
  - `trades_skipped_by_risk` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

- `PortfolioResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
  - `equity_curve` - –∫—Ä–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∞ (—Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ {timestamp, balance})
  - `positions` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
  - `stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è

- `PortfolioEngine` - –¥–≤–∏–∂–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
  - –ú–µ—Ç–æ–¥ `simulate()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏:
    1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ backtest window
    2. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ entry_time
    3. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–¥–µ–ª–æ–∫ —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π
    4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π, —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è)
    5. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (fixed/dynamic)
    6. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π –∫ PnL
    7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ equity curve
    8. –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
- ‚úÖ –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–µ—Ä–µ—ç–∫—Å–ø–æ–∑–∏—Ü–∏—é
- ‚úÖ Equity curve –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–Ω–∞–º–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

##### 2. **–û–±–Ω–æ–≤–ª–µ–Ω `backtester/domain/position.py`**

**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª—è `meta` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `meta: Dict[str, Any] = None` ‚Üí `meta: Dict[str, Any] = field(default_factory=dict)`

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None
- –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (strategy, raw_pnl_pct, fee_pct, pnl_sol)

##### 3. **–û–±–Ω–æ–≤–ª–µ–Ω `backtester/application/runner.py`**

**–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç—ã: `PortfolioConfig`, `PortfolioEngine`, `FeeModel`, `PortfolioResult`
- –ê—Ç—Ä–∏–±—É—Ç `self.portfolio_results: Dict[str, PortfolioResult]` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º
- –ú–µ—Ç–æ–¥ `_build_portfolio_config()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∏–∑ YAML:
  - –ü–∞—Ä—Å–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ `backtest` (start_at, end_at)
  - –ü–∞—Ä—Å–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ `portfolio` (–±–∞–ª–∞–Ω—Å, —Ä–µ–∂–∏–º –∞–ª–ª–æ–∫–∞—Ü–∏–∏, –ª–∏–º–∏—Ç—ã)
  - –ü–∞—Ä—Å–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ `fee` (–∫–æ–º–∏—Å—Å–∏–∏ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ)
  - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ `FeeModel` –∏ `PortfolioConfig`

- –ú–µ—Ç–æ–¥ `run_portfolio()` - –∑–∞–ø—É—Å–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏:
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  - –ó–∞–ø—É—Å–∫ `PortfolioEngine.simulate()` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `self.portfolio_results`
  - –í—ã–≤–æ–¥ –∫—Ä–∞—Ç–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Ö –∫–æ–¥–µ
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML

##### 4. **–û–±–Ω–æ–≤–ª–µ–Ω `backtester/infrastructure/reporter.py`**

**–¶–µ–ª—å:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ú–µ—Ç–æ–¥ `save_portfolio_results()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
  - `{strategy_name}_equity_curve.csv` - –∫—Ä–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∞
  - `{strategy_name}_portfolio_positions.csv` - –≤—Å–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
  - `{strategy_name}_portfolio_stats.json` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - –í—ã–∑–æ–≤ `plot_portfolio_equity_curve()` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞

- –ú–µ—Ç–æ–¥ `plot_portfolio_equity_curve()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ equity curve:
  - –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ä–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - –õ–∏–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `{strategy_name}_portfolio_equity.png`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏

##### 5. **–û–±–Ω–æ–≤–ª–µ–Ω `config/backtest_example.yaml`**

**–¶–µ–ª—å:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- –°–µ–∫—Ü–∏—è `backtest`:
  - `start_at` - –Ω–∞—á–∞–ª–æ –æ–∫–Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `end_at` - –∫–æ–Ω–µ—Ü –æ–∫–Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –°–µ–∫—Ü–∏—è `portfolio`:
  - `initial_balance_sol: 10.0` - –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
  - `allocation_mode: "dynamic"` - —Ä–µ–∂–∏–º –∞–ª–ª–æ–∫–∞—Ü–∏–∏
  - `percent_per_trade: 0.1` - –¥–æ–ª—è –∫–∞–ø–∏—Ç–∞–ª–∞ –Ω–∞ —Å–¥–µ–ª–∫—É
  - `max_exposure: 0.5` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
  - `max_open_positions: 10` - –º–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
  - `runner_reset_enabled: false` - —Ñ–ª–∞–≥ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
  - –°–µ–∫—Ü–∏—è `fee`:
    - `swap_fee_pct: 0.003` - –∫–æ–º–∏—Å—Å–∏—è swap (0.3%)
    - `lp_fee_pct: 0.001` - –∫–æ–º–∏—Å—Å–∏—è LP (0.1%)
    - `slippage_pct: 0.10` - –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (10%)
    - `network_fee_sol: 0.0005` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –õ–µ–≥–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏—è–º–∏

##### 6. **–û–±–Ω–æ–≤–ª–µ–Ω `main.py`**

**–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (`runner.run()`) –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `runner.run_portfolio()`
- –í—ã–≤–æ–¥ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ "PORTFOLIO SIMULATION"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `reporter.save_portfolio_results()`
- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π workflow
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

##### 7. **–°–æ–∑–¥–∞–Ω `docs/PORTFOLIO_LAYER.md`**

**–¶–µ–ª—å:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è
- –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –º–æ–¥—É–ª–µ–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞
- –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

#### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:

1. **–£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏:**
   - –ö–æ–º–∏—Å—Å–∏–∏ swap –∏ LP
   - –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (10% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –°–µ—Ç–µ–≤—ã–µ –∫–æ–º–∏—Å—Å–∏–∏

2. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å:**
   - Equity curve (–∫—Ä–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∞)
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è (return, drawdown, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫)
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–æ–∑–∏—Ü–∏—è–º

4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç backtest window:**
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –æ–∫–Ω—É

#### üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –û—Ç–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–¥–µ–ª–∫–∏ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ entry_time –∏ exit_time –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö backtest window
2. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** –°–¥–µ–ª–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ entry_time
3. **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π:** –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö exit_time <= entry_time –Ω–æ–≤–æ–π
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤:** 
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
5. **–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:** –ù–∞ –æ—Å–Ω–æ–≤–µ allocation_mode –∏ percent_per_trade
6. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π:** –ò–∑ PnL –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∫–æ–º–∏—Å—Å–∏–∏ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:** –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π
8. **–†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –§–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å, –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å–∞–¥–∫–∞

#### üìà –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:
- `{strategy_name}_equity_curve.csv` - –∫—Ä–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∞
- `{strategy_name}_portfolio_positions.csv` - –≤—Å–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- `{strategy_name}_portfolio_stats.json` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- `{strategy_name}_portfolio_equity.png` - –≥—Ä–∞—Ñ–∏–∫ equity curve

#### üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
python main.py
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—É—é —Å–∏–º—É–ª—è—Ü–∏—é
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –†–µ–∂–∏–º Runner-XN (–∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ XN –ª—é–±–æ–π –ø–æ–∑–∏—Ü–∏–µ–π)
- [ ] –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∫–æ–º–∏—Å—Å–∏–π
- [ ] –£—á–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- [ ] –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## [Phase 3] - 2025-01-XX

### –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –§–∞–∑–∞ 3: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –µ–¥–∏–Ω—ã–π RR-–¥–≤–∏–∂–æ–∫

#### üîß –ó–∞–¥–∞—á–∞ 1: –í—ã–Ω–µ—Å–µ–Ω–∞ –æ–±—â–∞—è RR-–ª–æ–≥–∏–∫–∞ –≤ —Ö–µ–ª–ø–µ—Ä

**–°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `backtester/domain/rr_utils.py`:**
- –§—É–Ω–∫—Ü–∏—è `apply_rr_logic()` - –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ TP/SL/timeout –¥–ª—è –≤—Å–µ—Ö RR-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- –§—É–Ω–∫—Ü–∏—è `check_candle_quality()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π
- –§—É–Ω–∫—Ü–∏—è `calculate_volatility_around_entry()` - —Ä–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –§—É–Ω–∫—Ü–∏—è `calculate_signal_to_entry_delay()` - —Ä–∞—Å—á–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –≤—Ö–æ–¥–∞

**–û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- `RRStrategy` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `apply_rr_logic()` –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- `RRDStrategy` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `apply_rr_logic()` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ RR –∏ RRD —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã
- ‚úÖ –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (RRR, RRTS, Trailing RR)

#### üîß –ó–∞–¥–∞—á–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω—ã ATR-—Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π:**
- ‚úÖ `volume > 0` - –æ–±—ä–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º
- ‚úÖ `high >= low` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å OHLC –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `high >= open/close` –∏ `low <= open/close` - –ª–æ–≥–∏–∫–∞ —Å–≤–µ—á–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∞—á–∫–æ–≤ —Ü–µ–Ω—ã - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–¥–µ–ª–∫–∏ –ø—Ä–∏ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö —Å–∫–∞—á–∫–∞—Ö (> X% –∑–∞ 1 –º–∏–Ω—É—Ç—É)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- `RRStrategy` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–∏ –≤—Ö–æ–¥–∞
- `RRDStrategy` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —Å–≤–µ—á–µ–π –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤—Ö–æ–¥–∞ (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º)

**–ü–∞—Ä–∞–º–µ—Ç—Ä `max_price_jump_pct`** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.5%)

#### üîß –ó–∞–¥–∞—á–∞ 3: –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ StrategyOutput.meta

**–ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- ‚úÖ `minutes_in_market` - –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö
- ‚úÖ `max_favorable_excursion` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –¥–æ –≤—ã—Ö–æ–¥–∞ (–≤ –¥–æ–ª—è—Ö)
- ‚úÖ `max_adverse_excursion` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫ –¥–æ –≤—ã—Ö–æ–¥–∞ (–≤ –¥–æ–ª—è—Ö)
- ‚úÖ `volatility_around_entry` - –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –≤–æ–∫—Ä—É–≥ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
- ‚úÖ `signal_to_entry_delay_minutes` - –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –≤—Ö–æ–¥–æ–º (–≤ –º–∏–Ω—É—Ç–∞—Ö)

**–û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è RRD-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**, –∫–æ—Ç–æ—Ä–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∫ –∑–∞–¥–µ—Ä–∂–∫–µ –≤—Ö–æ–¥–∞.

#### üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- ‚úÖ –°–æ–∑–¥–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è `rr_utils.py` (`tests/domain/test_rr_utils.py`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- ‚úÖ –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω –ª–∏–Ω—Ç–µ—Ä–æ–º - –æ—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

---

## [Phase 2] - 2025-01-XX

### –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –§–∞–∑–∞ 2: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≤–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π OHLCV –≤ GeckoTerminalPriceLoader**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π: `[timestamp, open, high, low, close, volume]`

2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω end_time –≤ –≤—ã–∑–æ–≤ loader.load_prices() –≤ rr_strategy.py**
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–µ—á–µ–π –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–æ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

3. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–≤–µ—á–µ–π**
   - –§—É–Ω–∫—Ü–∏—è `validate_candle()` —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ OHLCV –¥–∞–Ω–Ω—ã—Ö

4. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Reporter —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏**
   - –†–∞—Å—á–µ—Ç winrate, Sharpe ratio, max drawdown, profit factor –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç—Ä–∏–∫
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CSV, HTML –æ—Ç—á–µ—Ç–æ–≤ –∏ equity curve –≥—Ä–∞—Ñ–∏–∫–æ–≤

5. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ RRD-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å –≤—Ö–æ–¥–æ–º –ø–æ drawdown**
   - –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ drawdown —Å TP/SL
   - –ü–∞—Ä–∞–º–µ—Ç—Ä `entry_wait_minutes` –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è –≤—Ö–æ–¥–∞

#### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

6. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã**
   - –¢–µ—Å—Ç—ã –¥–ª—è RR, RRD –∏ Runner —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

7. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤**
   - ThreadPoolExecutor –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

8. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ retry-–ª–æ–≥–∏–∫–∞ –¥–ª—è API**
   - –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `retry_on_failure` —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

9. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   - –ì—Ä–∞—Ñ–∏–∫–∏ equity curve, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è PnL, –ø—Ä–∏—á–∏–Ω—ã –≤—ã—Ö–æ–¥–∞, –≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ —Å–¥–µ–ª–æ–∫

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backtester/
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ runner.py           # BacktestRunner —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # Signal, Candle, StrategyInput, StrategyOutput
‚îÇ   ‚îú‚îÄ‚îÄ strategy_base.py    # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Strategy
‚îÇ   ‚îú‚îÄ‚îÄ rr_strategy.py      # RR —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç rr_utils)
‚îÇ   ‚îú‚îÄ‚îÄ rrd_strategy.py     # RRD —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç rr_utils)
‚îÇ   ‚îú‚îÄ‚îÄ rr_utils.py         # –û–±—â–∞—è RR-–ª–æ–≥–∏–∫–∞ –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ runner_strategy.py  # Runner —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îî‚îÄ‚îÄ infrastructure/
    ‚îú‚îÄ‚îÄ signal_loader.py    # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏–∑ CSV
    ‚îú‚îÄ‚îÄ price_loader.py     # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π (CSV + GeckoTerminal API)
    ‚îî‚îÄ‚îÄ reporter.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫

tests/
‚îî‚îÄ‚îÄ domain/
    ‚îú‚îÄ‚îÄ test_rr_strategy.py
    ‚îú‚îÄ‚îÄ test_rrd_strategy.py
    ‚îú‚îÄ‚îÄ test_runner_strategy.py
    ‚îî‚îÄ‚îÄ test_rr_utils.py
```


