# –ê—É–¥–∏—Ç —Ç–µ—Å—Ç–æ–≤ –∏ –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 49
- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 49 (100%) ‚úÖ
- **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ**: 0 (0%) ‚úÖ

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤

### 1. `test_rr_strategy_tp_hit` (RRStrategy)

**–û—à–∏–±–∫–∞:**
```
AssertionError: assert 110.00000000000001 == 110.0
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
- `tp_price` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `entry_price * (1 + tp_pct)` = `100.0 * 1.1` = `110.0`
- –ù–æ –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π float-–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è `110.00000000000001`
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `apply_rr_logic` (—Å—Ç—Ä–æ–∫–∞ 135) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `exit_price=tp_price`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pytest.approx()` –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ü–µ–Ω –≤—ã—Ö–æ–¥–∞
- –ò–ª–∏ –æ–∫—Ä—É–≥–ª—è—Ç—å `tp_price` –¥–æ —Ä–∞–∑—É–º–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏)

---

### 2. `test_rr_strategy_timeout` (RRStrategy)

**–û—à–∏–±–∫–∞:**
```
AssertionError: assert 100.01 == 100.0
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –¢–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á–∏ —Å `open=entry_price + i * 0.01` –¥–ª—è `i in range(1, 6)`
- –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ –∏–º–µ–µ—Ç `open=100.01`, `close=100.01`
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `entry_candle.close` –∫–∞–∫ —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (—Å—Ç—Ä–æ–∫–∞ 59 –≤ `rr_strategy.py`)
- –¢–µ—Å—Ç –æ–∂–∏–¥–∞–µ—Ç `entry_price == 100.0`, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç `100.01`

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç: –ø–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å `close=100.0`
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–µ –Ω–∞ `100.01`

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–æ—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

---

### 3-6. –¢–µ—Å—Ç—ã RRDStrategy (4 —Ç–µ—Å—Ç–∞)

–í—Å–µ 4 —Ç–µ—Å—Ç–∞ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É:

- `test_rrd_strategy_tp_after_entry`
- `test_rrd_strategy_sl_after_entry`
- `test_rrd_strategy_timeout_after_entry`
- `test_rrd_strategy_entry_price_target_calculation`

**–û—à–∏–±–∫–∞:**
```
AssertionError: assert None == 75.0 ¬± 0.075
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Å–≤–µ—á–∏ —Å –±–æ–ª—å—à–∏–º —Å–∫–∞—á–∫–æ–º —Ü–µ–Ω—ã:
  - –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞: `close=100.0`
  - –í—Ç–æ—Ä–∞—è —Å–≤–µ—á–∞: `open=76.0` (–¥–ª—è –≤—Ö–æ–¥–∞ –ø–æ drawdown 25%)
  - –°–∫–∞—á–æ–∫: `(100.0 - 76.0) / 100.0 * 100 = 24%`
- –§—É–Ω–∫—Ü–∏—è `check_candle_quality` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫–∞—á–æ–∫ –º–µ–∂–¥—É `previous_candle.close` –∏ `current_candle.open`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∫–∞—á–æ–∫: `max_price_jump_pct = 0.5%` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°–≤–µ—á–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (—Å—Ç—Ä–æ–∫–∞ 109 –≤ `rrd_strategy.py`)
- –í—Ö–æ–¥ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, `entry_price` –æ—Å—Ç–∞–µ—Ç—Å—è `None`

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:**
```
‚ö†Ô∏è Skipping anomalous candle at 2024-01-01 12:02:00+00:00: price jump too large: 24.00% (max 0.5%)
```

**–†–µ—à–µ–Ω–∏–µ:**
1. **–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)**: –£–≤–µ–ª–∏—á–∏—Ç—å `max_price_jump_pct` –≤ —Ç–µ—Å—Ç–∞—Ö —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
2. **–í–∞—Ä–∏–∞–Ω—Ç 2**: –°–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º —Ü–µ–Ω—ã
3. **–í–∞—Ä–∏–∞–Ω—Ç 3**: –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π –≤ —Ç–µ—Å—Ç–∞—Ö (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (—Ç–µ—Å—Ç—ã –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)

---

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ó–∞–¥–∞—á–∞ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å float –≤ `test_rr_strategy_tp_hit`

**–§–∞–π–ª:** `tests/domain/test_rr_strategy.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `assert result.exit_price == tp_price` –Ω–∞ `assert result.exit_price == pytest.approx(tp_price, rel=1e-6)`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å —É—á–µ—Ç–æ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ float

---

### –ó–∞–¥–∞—á–∞ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ –≤ `test_rr_strategy_timeout`

**–§–∞–π–ª:** `tests/domain/test_rr_strategy.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–∑–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–≤–µ—á–µ–π —Ç–∞–∫, —á—Ç–æ–±—ã –ø–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ –∏–º–µ–ª–∞ `close=entry_price` (100.0)
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ: `assert result.entry_price == pytest.approx(100.01, rel=1e-3)`

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
```python
candles = [
    Candle(
        timestamp=sample_signal.timestamp + timedelta(minutes=i),
        open=entry_price + (i - 1) * 0.01,  # –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞: open=100.0
        high=entry_price + (i - 1) * 0.01 + 0.1,
        low=entry_price + (i - 1) * 0.01 - 0.1,
        close=entry_price + i * 0.01,  # –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞: close=100.01, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 100.0
        volume=1000.0
    )
    for i in range(1, 6)
]
# –ò–ª–∏ –ø—Ä–æ—â–µ: –ø–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ —Å close=100.0
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞

---

### –ó–∞–¥–∞—á–∞ 3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã RRDStrategy (4 —Ç–µ—Å—Ç–∞)

**–§–∞–π–ª—ã:** `tests/domain/test_rrd_strategy.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–∫–∞—á–∫–∏ —Ü–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π.

**–†–µ—à–µ–Ω–∏–µ 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π): –£–≤–µ–ª–∏—á–∏—Ç—å max_price_jump_pct –≤ —Ç–µ—Å—Ç–∞—Ö**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í –∫–∞–∂–¥–æ–º –ø—Ä–æ–≤–∞–ª–∏–≤—à–µ–º—Å—è —Ç–µ—Å—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º `max_price_jump_pct`
- –ù–∞–ø—Ä–∏–º–µ—Ä: `max_price_jump_pct: 30.0` (–±–æ–ª—å—à–µ —á–µ–º 25% drawdown)

**–ü—Ä–∏–º–µ—Ä:**
```python
def test_rrd_strategy_tp_after_entry(rrd_strategy, sample_signal):
    # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º max_price_jump_pct –¥–ª—è —Ç–µ—Å—Ç–∞
    config = StrategyConfig(
        name="test_rrd_tp",
        type="RRD",
        params={
            "drawdown_entry_pct": 25,
            "tp_pct": 20,
            "sl_pct": 10,
            "max_minutes": 1000,
            "entry_wait_minutes": 360,
            "max_price_jump_pct": 30.0  # –†–∞–∑—Ä–µ—à–∞–µ–º –±–æ–ª—å—à–∏–µ —Å–∫–∞—á–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
        }
    )
    strategy = RRDStrategy(config)
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ç–µ—Å—Ç–∞
```

**–†–µ—à–µ–Ω–∏–µ 2: –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–≤–µ—á–∏ –º–µ–∂–¥—É –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω–æ–π (100.0) –∏ —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ (75.0)
- –ö–∞–∂–¥–∞—è —Å–≤–µ—á–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Å–∫–∞—á–æ–∫ –Ω–µ –±–æ–ª–µ–µ 0.5% –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
candles = [
    # –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ (–±–∞–∑–æ–≤–∞—è)
    Candle(..., close=100.0),
    # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–≤–µ—á–∏ —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º
    Candle(..., close=99.5),  # -0.5%
    Candle(..., close=99.0),  # -0.5%
    # ... –µ—â–µ –º–Ω–æ–≥–æ —Å–≤–µ—á–µ–π
    # –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–µ—á–∞ —Å –≤—Ö–æ–¥–æ–º
    Candle(..., low=75.0, ...)
]
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–µ—à–µ–Ω–∏–µ 1, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –ø—Ä–æ—â–µ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–≤–µ—á–µ–π.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ 4 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç
- –í—Ö–æ–¥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `entry_price` —Ä–∞–≤–µ–Ω –æ–∂–∏–¥–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ó–∞–¥–∞—á–∞ 3 (RRDStrategy —Ç–µ—Å—Ç—ã) - 4 —Ç–µ—Å—Ç–∞, –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ó–∞–¥–∞—á–∞ 2 (test_rr_strategy_timeout) - –æ—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ó–∞–¥–∞—á–∞ 1 (test_rr_strategy_tp_hit) - –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

1. **"WARNING: Signal at ... but first candle is at ..."**
   - –≠—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞
   - –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ —Ç–µ—Å—Ç–æ–≤, —Å–æ–∑–¥–∞–≤ —Å–≤–µ—á–∏ —Ç–æ—á–Ω–æ –≤ –º–æ–º–µ–Ω—Ç —Å–∏–≥–Ω–∞–ª–∞

2. **"Skipping anomalous candle ... price jump too large"**
   - –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–≤–∞–ª–∞ —Ç–µ—Å—Ç–æ–≤ RRDStrategy
   - –†–µ—à–∞–µ—Ç—Å—è —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º `max_price_jump_pct` –≤ —Ç–µ—Å—Ç–∞—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pytest.approx() –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π —Ü–µ–Ω**
   - –ò–∑–±–µ–≥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é float

2. **–°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –£—á–∏—Ç—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, max_price_jump_pct)

3. **–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `max_price_jump_pct`

4. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤**
   - –¢–µ—Å—Ç—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ —Å–∫–∞—á–∫–∞–º–∏ —Ü–µ–Ω—ã
   - –¢–µ—Å—Ç—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Å–∫–∞—á–∫–∞–º–∏

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rr_strategy_tp_hit` (–¥–æ–±–∞–≤–∏—Ç—å pytest.approx)
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rr_strategy_timeout` (–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rrd_strategy_tp_after_entry` (—É–≤–µ–ª–∏—á–∏—Ç—å max_price_jump_pct)
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rrd_strategy_sl_after_entry` (—É–≤–µ–ª–∏—á–∏—Ç—å max_price_jump_pct)
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rrd_strategy_timeout_after_entry` (—É–≤–µ–ª–∏—á–∏—Ç—å max_price_jump_pct)
- [x] ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_rrd_strategy_entry_price_target_calculation` (—É–≤–µ–ª–∏—á–∏—Ç—å max_price_jump_pct)
- [x] ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [x] ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —Å–ª–æ–º–∞–ª–∏ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `tests/domain/test_rr_strategy.py` - —Ç–µ—Å—Ç—ã RRStrategy
- `tests/domain/test_rrd_strategy.py` - —Ç–µ—Å—Ç—ã RRDStrategy
- `backtester/domain/rr_strategy.py` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RRStrategy
- `backtester/domain/rrd_strategy.py` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RRDStrategy
- `backtester/domain/rr_utils.py` - —É—Ç–∏–ª–∏—Ç—ã (check_candle_quality, apply_rr_logic)

---

## ‚úÖ Applied fixes (2025-01-27)

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã. –í—Å–µ 49 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç.

### –ö–æ–º–º–∏—Ç—ã:

1. **test: use pytest.approx for tp exit_price (float precision)**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ float –≤ `test_rr_strategy_tp_hit`
   - –ó–∞–º–µ–Ω–µ–Ω–æ —Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ `pytest.approx(tp_price, rel=1e-6)`

2. **test: fix timeout test candles so entry close matches expected**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `test_rr_strategy_timeout`
   - –ü–µ—Ä–≤–∞—è —Å–≤–µ—á–∞ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç `close=100.0` –≤–º–µ—Å—Ç–æ `100.01`

3. **test: relax max_price_jump_pct in RRD tests to allow drawdown entry candles**
   - –°–æ–∑–¥–∞–Ω–∞ —Ñ–∏–∫—Å—Ç—É—Ä–∞ `rrd_strategy_relaxed_jump` —Å `max_price_jump_pct: 30.0`
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã 4 —Ç–µ—Å—Ç–∞ RRDStrategy –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ —Å–∫–∞—á–∫–æ–≤ —Ü–µ–Ω—ã
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã: `test_rrd_strategy_tp_after_entry`, `test_rrd_strategy_sl_after_entry`, `test_rrd_strategy_timeout_after_entry`, `test_rrd_strategy_entry_price_target_calculation`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í—Å–µ 49 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (100%)
- ‚úÖ 0 –ø—Ä–æ–≤–∞–ª–æ–≤
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27  
**–î–∞—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 2025-01-27  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
