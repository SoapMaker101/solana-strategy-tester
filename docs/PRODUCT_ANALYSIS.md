# Продуктовый анализ Solana Strategy Tester v2.1.9

**Версия фиксации:** 2.1.9 (Frozen Baseline)  
**Дата фиксации:** 2025-01-06  
**Режим:** Runner-only

---

## 1. Продуктовое позиционирование

### Что это за продукт

Solana Strategy Tester — это backtesting framework для торговых стратегий на блокчейне Solana. Продукт предназначен для тестирования стратегий на исторических данных с использованием внешних торговых сигналов.

### Для кого

**Основные пользователи:**

1. **Исследователи:**
   - Тестируют гипотезы о торговых стратегиях
   - Анализируют исторические данные
   - Экспериментируют с параметрами стратегий

2. **Кванты / трейдеры:**
   - Оценивают эффективность стратегий
   - Отбирают лучшие стратегии для использования
   - Анализируют риски и устойчивость

3. **Разработчики стратегий:**
   - Разрабатывают новые стратегии
   - Оптимизируют параметры существующих стратегий
   - Валидируют стратегии перед использованием

### Для чего НЕ предназначен

Продукт **НЕ предназначен** для:

- **Live-trading:** Нет подключения к реальным биржам, нет отправки ордеров
- **Автоматической торговли:** Нет управления реальным портфелем
- **Машинного обучения:** Нет компонентов ML, нет обучения моделей
- **Оптимизации гиперпараметров:** Нет автоматической оптимизации через ML
- **Онлайн-адаптации:** Нет адаптации стратегий в реальном времени
- **Self-healing:** Нет автоматического исправления ошибок

---

## 2. Основная ценность

### Runner strategies

Продукт поддерживает только Runner стратегии (лестница тейк-профитов):

- Частичное закрытие позиций на разных уровнях прибыли (например, 2x, 5x, 10x)
- Реалистичная симуляция торговли с учетом slippage и комиссий
- Детерминированная симуляция для воспроизводимости результатов

### Tail-driven подход

Продукт ориентирован на tail-driven подход:

- Фокус на редких, но высокодоходных сделках (tail events)
- Метрики для оценки вклада tail сделок (`tail_pnl_share`, `hit_rate_x4`, `hit_rate_x5`)
- Критерии отбора учитывают tail contribution

### Portfolio-level thinking

Продукт работает на уровне портфеля:

- Учитывает ограничения портфеля (max_open_positions, max_exposure)
- Симулирует реальное управление капиталом
- Учитывает комиссии и slippage на уровне портфеля
- Поддерживает profit reset и capacity prune логику

---

## 3. Пользовательские сценарии

### Исследователь

**Сценарий 1: Тестирование гипотезы**

1. Подготавливает CSV файл с сигналами
2. Настраивает конфигурацию стратегий
3. Запускает бэктест: `python main.py --signals ... --strategies-config ...`
4. Анализирует результаты в `portfolio_positions.csv` и `portfolio_events.csv`
5. Запускает Stage A для оценки устойчивости
6. Запускает Stage B для отбора лучших стратегий

**Сценарий 2: Экспериментирование с параметрами**

1. Генерирует grid параметров для стратегий
2. Запускает бэктест на всех комбинациях
3. Анализирует `strategy_stability.csv` для понимания влияния параметров
4. Выбирает оптимальные параметры на основе метрик

### Квант / трейдер

**Сценарий 1: Оценка эффективности стратегии**

1. Запускает бэктест на исторических данных
2. Анализирует портфельные метрики (final balance, total return, max drawdown)
3. Запускает Audit для проверки консистентности данных
4. Запускает Stage A для оценки устойчивости на разных периодах
5. Принимает решение о использовании стратегии на основе метрик

**Сценарий 2: Отбор стратегий для использования**

1. Запускает бэктест на множестве стратегий
2. Запускает Stage A для расчета метрик устойчивости
3. Запускает Stage B для автоматического отбора
4. Анализирует `strategy_selection.csv` с прошедшими стратегиями
5. Выбирает стратегии для использования на основе результатов

### Разработчик стратегии

**Сценарий 1: Разработка новой стратегии**

1. Разрабатывает логику стратегии (наследует `RunnerStrategy`)
2. Настраивает параметры стратегии (levels, fractions, max_hold_minutes)
3. Тестирует стратегию на исторических данных
4. Анализирует результаты и итеративно улучшает стратегию

**Сценарий 2: Валидация стратегии**

1. Запускает бэктест на разных временных периодах
2. Запускает Audit для проверки отсутствия аномалий
3. Запускает Stage A для оценки устойчивости
4. Запускает Stage B для проверки соответствия критериям
5. Валидирует стратегию перед использованием в production

---

## 4. Почему Runner-only

### Что было отброшено

В версии 2.1.9 отброшены:

- **Legacy стратегии (RR, RRD):** Удалены из кодовой базы
- **Множественные типы стратегий:** Поддерживается только Runner
- **Сложная архитектура:** Упрощена для поддержки одного типа стратегий

### Почему это осознанно

Runner-only режим выбран осознанно:

- **Упрощение архитектуры:** Один тип стратегий упрощает код и тестирование
- **Фокус на качестве:** Концентрация на одном типе стратегий позволяет лучше протестировать и оптимизировать
- **Tail-driven подход:** Runner стратегии лучше подходят для tail-driven подхода
- **Стабильность:** Упрощение снижает риск ошибок и облегчает поддержку

---

## 5. Stage A / Stage B как продуктовые этапы

### Stage A = исследование

**Назначение:** Оценка устойчивости стратегий на разных временных периодах

**Что делает:**
- Разбивает данные на временные окна (2, 3, 4, 5 частей)
- Вычисляет метрики устойчивости (survival rate, worst window PnL, median window PnL, PnL variance)
- Генерирует `strategy_stability.csv` с метриками

**Что НЕ делает:**
- Не принимает решений о стратегиях
- Не изменяет execution
- Не проверяет инварианты (это делает Audit)

**Продуктовая ценность:**
- Позволяет понять, насколько стабильна стратегия на разных периодах
- Помогает выявить стратегии, которые работают только на определенных периодах
- Дает метрики для принятия решений в Stage B

### Stage B = решение

**Назначение:** Автоматический отбор стратегий на основе критериев

**Что делает:**
- Применяет критерии отбора (V1/V2) к стратегиям
- Генерирует `strategy_selection.csv` с результатами отбора
- Фиксирует причины отклонения стратегий

**Что НЕ делает:**
- Не изменяет execution (decision не влияет на execution)
- Не проверяет инварианты (это делает Audit)
- Не гарантирует прибыльность (только фильтрует по критериям)

**Продуктовая ценность:**
- Автоматизирует отбор стратегий
- Экономит время на ручной анализ
- Дает прозрачные критерии отбора

### Почему decision не влияет на execution

Decision layer (Stage B) не влияет на execution по следующим причинам:

- **Разделение ответственности:** Execution и decision — разные этапы пайплайна
- **Детерминированность:** Execution должен быть детерминированным, независимо от decision
- **Гибкость:** Позволяет применять разные критерии отбора без изменения execution
- **Аудит:** Разделение позволяет аудиту проверять execution независимо от decision

---

## 6. Почему audit — обязательный этап

### Почему нельзя "просто посмотреть PnL"

PnL сам по себе не дает полной картины:

- **Консистентность данных:** PnL может быть вычислен неправильно
- **Ошибки в данных:** Могут быть аномалии в ценах, временах, причинах выхода
- **Целостность событий:** Могут отсутствовать события или быть нарушены связи
- **Reason consistency:** Причины выхода могут не соответствовать фактическому PnL

### Почему ошибки важнее доходности

Ошибки в данных критичнее, чем доходность, потому что:

- **Доверие к результатам:** Если есть ошибки в данных, нельзя доверять результатам
- **Риск принятия неправильных решений:** Ошибки могут привести к выбору плохих стратегий
- **Воспроизводимость:** Ошибки нарушают воспроизводимость результатов
- **Блокировка дальнейших этапов:** P0 аномалии блокируют Stage A/B

### Обязательность audit

Audit является обязательным этапом:

- **Перед Stage A:** Stage A отказывается запускаться при P0 > 0
- **Перед Stage B:** Stage B отказывается запускаться при P0 > 0
- **Гарантия качества:** Audit гарантирует качество данных перед дальнейшей обработкой

---

## 7. Ограничения продукта v2.1.9

### Нет auto-optimization

Продукт не выполняет автоматическую оптимизацию:

- Нет автоматического подбора параметров стратегий
- Нет grid search с автоматическим выбором лучших параметров
- Пользователь должен вручную экспериментировать с параметрами

### Нет online-адаптации

Продукт не поддерживает онлайн-адаптацию:

- Нет адаптации стратегий в реальном времени
- Нет обучения на новых данных
- Нет автоматической корректировки параметров

### Нет self-healing

Продукт не имеет self-healing механизмов:

- Нет автоматического исправления ошибок
- Нет автоматического восстановления после сбоев
- Пользователь должен вручную исправлять проблемы

---

## 8. Что продукт НЕ обещает

### Альфу

Продукт не обещает альфу (превышение рынка):

- Результаты бэктеста не гарантируют будущую прибыльность
- Исторические данные могут не отражать будущее поведение рынка
- Продукт только тестирует стратегии, но не гарантирует их успех

### ROI

Продукт не обещает конкретный ROI:

- Результаты бэктеста зависят от входных данных и параметров
- Реальная торговля может отличаться от симуляции
- Продукт не гарантирует доходность

### Автоматический выбор

Продукт не обещает автоматический выбор лучших стратегий:

- Stage B только фильтрует стратегии по критериям
- Критерии могут быть неоптимальными для конкретных условий
- Пользователь должен принимать финальное решение о выборе стратегий

---

## Ссылки

- `docs/ARCHITECTURE.md` — архитектура проекта
- `docs/PIPELINE_GUIDE.md` — описание пайплайна данных
- `docs/RELEASE_2.1.9.md` — полное описание релиза


