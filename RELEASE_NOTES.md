# üéâ Release Notes: Phase 4+ - Trade Features & Export Improvements

**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Phase 4+  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Ready for Production

---

## üì¶ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ

### ‚ú® Trade Features

–ö–∞–∂–¥–∞—è —Å–¥–µ–ª–∫–∞ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

- **Market Cap Proxy:**
  - `entry_mcap_proxy` ‚Äî market cap –Ω–∞ –≤—Ö–æ–¥–µ (price √ó supply)
  - `exit_mcap_proxy` ‚Äî market cap –Ω–∞ –≤—ã—Ö–æ–¥–µ
  - `mcap_change_pct` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ market cap –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
  - `total_supply_used` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ supply (–∏–∑ Signal.extra –∏–ª–∏ default 1B)

- **Volume & Volatility Windows (5m/15m/60m):**
  - `vol_sum_5m`, `vol_sum_15m`, `vol_sum_60m` ‚Äî —Å—É–º–º–∞ –æ–±—ä—ë–º–æ–≤ –¥–æ –≤—Ö–æ–¥–∞
  - `range_pct_5m`, `range_pct_15m`, `range_pct_60m` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω (max-min)/entry_price
  - `volat_5m`, `volat_15m`, `volat_60m` ‚Äî –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (std of returns)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ù–µ—Ç data leakage ‚Äî –æ–∫–Ω–∞ –±–µ—Ä—É—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –î–û entry_time
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏—Ö API
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –≤ `StrategyOutput.meta` –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

---

### üìä Trades Table Export

–ù–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –≤ –µ–¥–∏–Ω—É—é CSV-—Ç–∞–±–ª–∏—Ü—É:

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç:**
- –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ `{strategy}_trades.csv` –≤ `output/reports/`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
- –ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—è: signal_id, contract_address, entry_time, exit_time, prices, pnl, reason
- –†–∞—Å–ø–ª—é—â–µ–Ω–Ω—ã–π meta: –≤—Å–µ –∫–ª—é—á–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `meta_`
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ JSON strings

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ main.py –ø–æ—Å–ª–µ –±—ç–∫—Ç–µ—Å—Ç–∞
reporter.save_trades_table(strategy_name, results)
```

---

### üõ°Ô∏è Reset Policy Tests

–ó–∞—â–∏—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

- ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ (RR, RRD, Runner) **–Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç** reset-—Ñ–ª–∞–≥–∏ –≤ meta
- ‚úÖ Reset-—Ñ–ª–∞–≥–∏ (`triggered_reset`, `closed_by_reset`) –ø–æ—è–≤–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤ `Position.meta` –ø–æ—Å–ª–µ PortfolioEngine
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: reset ‚Äî –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- ‚úÖ **CHANGELOG.md** ‚Äî –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç 2025-12-14
- ‚úÖ **README.md** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–¥–µ–ª—ã –æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- ‚úÖ **TECHNICAL_REPORT.md** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **PROJECT_ANALYSIS.md** ‚Äî –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

---

## üß™ –¢–µ—Å—Ç—ã

**–î–æ–±–∞–≤–ª–µ–Ω–æ 19 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤:**

- `tests/test_trade_features.py` ‚Äî 10 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è trade features
- `tests/test_reporter_trades_table.py` ‚Äî 5 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è trades table export
- `tests/test_reset_policy_is_portfolio_only.py` ‚Äî 4 —Ç–µ—Å—Ç–∞ –¥–ª—è reset policy

**–ò—Ç–æ–≥–æ: 68 —Ç–µ—Å—Ç–æ–≤, –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç** ‚úÖ

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `backtester/domain/trade_features.py`
- `tests/test_trade_features.py`
- `tests/test_reporter_trades_table.py`
- `tests/test_reset_policy_is_portfolio_only.py`

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `backtester/domain/rr_strategy.py`
- `backtester/domain/rrd_strategy.py`
- `backtester/domain/runner_strategy.py`
- `backtester/infrastructure/reporter.py`
- `main.py`
- `README.md`
- `docs/CHANGELOG.md`
- `docs/TECHNICAL_REPORT.md`
- `docs/PROJECT_ANALYSIS.md`

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Trade Features

**–ú–æ–¥—É–ª—å:** `backtester/domain/trade_features.py`

**–§—É–Ω–∫—Ü–∏–∏:**
- `get_total_supply(signal, default=1_000_000_000)` ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç supply –∏–∑ Signal.extra
- `calc_mcap_proxy(price, supply)` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç market cap proxy
- `calc_window_features(candles, entry_time, entry_price, windows_min)` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–±—ä—ë–º–Ω—ã–µ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–Ω—ã–µ —Ñ–∏—á–∏
- `calc_trade_mcap_features(entry_price, exit_price, total_supply)` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç mcap features

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç trade features –≤ `StrategyOutput.meta`
- –§–∏—á–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ trades table export

### Trades Table Export

**–ú–µ—Ç–æ–¥:** `Reporter.save_trades_table(strategy_name, results, out_name=None)`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (entry_time != None, reason != no_entry/error)
- –†–∞—Å–ø–ª—é—â–∏–≤–∞–µ—Ç meta –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ (—Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ dict/list ‚Üí JSON string –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### Reset Policy

**–ü—Ä–∏–Ω—Ü–∏–ø:** Reset-–ø–æ–ª–∏—Ç–∏–∫–∞ ‚Äî –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏—è PortfolioEngine

**–¢–µ—Å—Ç—ã:**
- –ó–∞—â–∏—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Ñ–ª–∞–≥–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ–ª–∞–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### Trade Features

–§–∏—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–∞–∂–¥—É—é —Å–¥–µ–ª–∫—É. –î–æ—Å—Ç—É–ø–Ω—ã –≤:

```python
result = strategy.on_signal(data)
print(result.meta["entry_mcap_proxy"])  # Market cap –Ω–∞ –≤—Ö–æ–¥–µ
print(result.meta["vol_sum_5m"])        # –û–±—ä—ë–º –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –≤—Ö–æ–¥–∞
print(result.meta["volat_15m"])         # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞ 15 –º–∏–Ω—É—Ç
```

### Trades Table Export

–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –±—ç–∫—Ç–µ—Å—Ç–∞. –ù–∞—Ö–æ–¥–∏—Ç–µ –∏—Ö –≤:

```
output/reports/{strategy_name}_trades.csv
```

–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –≤ Excel, pandas, –∏–ª–∏ –ª—é–±–æ–º –¥—Ä—É–≥–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

---

## ‚ö†Ô∏è Breaking Changes

**–ù–µ—Ç breaking changes.** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã.

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫–æ–Ω –¥–ª—è volume/volatility features
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–∞ features
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è trades table

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/CHANGELOG.md`
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: `docs/TECHNICAL_REPORT.md`
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞: `docs/PROJECT_ANALYSIS.md`

---

**–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Solana Strategy Tester! üöÄ**
